/*! jquery.jelect.js v1.0.0 | felixexter | MIT License | https://github.com/CSSSR/jelect/ */
!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"==typeof exports?require("jquery"):jQuery)}(function(t){"use strict";var e,i,o,n="jelect";t[n]={version:"1.0.0",options:{classes:{autocomplete:n+"_type_autocomplete",containerActive:n+"_state_active",containerDisabled:n+"_state_disabled",currentActive:n+"-current_state_active",optionsActive:n+"-options_state_active",optionActive:n+"-option_state_active",optionDisabled:n+"-option_state_disabled",optionHide:n+"-option_state_hide"},plugins:[]},plugins:{},selectors:{container:".js-"+n,scroller:".js-"+n+"-scroller",input:".js-"+n+"-input",current:".js-"+n+"-current",options:".js-"+n+"-options",option:".js-"+n+"-option",optionValue:".js-"+n+"-option-value"},keyCode:{BACKSPACE:8,ENTER:13,ESC:27,DOWN:40,UP:38}},i=function(e){var i=this,o=t[n],s=o.selectors,a=o.options.classes,r=i.$jelectOptions.find(s.option+'[data-val="'+e+'"]'),l=r.find(s.optionValue).text();return r.hasClass(a.optionDisabled)?(console.error("Option {"+e+"} is disabled"),!1):(r.addClass(a.optionActive).siblings(s.option).removeClass(a.optionActive),i.$jelect.val(e).removeClass(a.containerActive).trigger("jelect.change"),i.autocomplete?i.$jelectCurrent.val(e):(i.$jelectCurrent.text(l).attr("data-val",e),i.$jelectInput.val(e).trigger("change")),void i.trigger("change"))},o=function(){var e=this,i=t[n].selectors,o=[];return e.$jelectOptions.find(i.option).each(function(e,i){var n=t(i);o.push({index:e,value:n.data("val")})}),o},e=function(e,i){var o=t[n],s=o.selectors,a=o.options.classes,r={$jelect:e,$jelectCurrent:e.find(s.current),$jelectOptions:e.find(s.options),$jelectInput:e.find(s.input),autocomplete:e.hasClass(a.autocomplete),options:t.extend(!0,{},o.options,i||{})};t.extend(!0,this,r),this.init()},e.prototype.init=function(){var e=this,o=t[n],s=o.selectors,a=e.options.classes,r=e.val();e.trigger("init"),e.values=e.serialize(),e.$jelect.val(r),e.$jelectCurrent.on("click "+n+".clickCurrent",function(){var i=t(s.container).filter("."+a.containerActive).not(e.$jelect),o=t(s.options).filter("."+a.optionsActive).not(e.$jelectOptions),n=e.$jelect.hasClass(a.containerDisabled),r=!e.$jelect.hasClass(a.containerActive)&&!e.$jelectOptions.hasClass(a.optionsActive);return n?!1:(r&&e.trigger("beforeOpen"),i.length&&o.length&&(i.removeClass(a.containerActive),o.removeClass(a.optionsActive)),e.$jelect.toggleClass(a.containerActive),e.$jelectOptions.toggleClass(a.optionsActive),e.autocomplete&&e.$jelectCurrent.trigger("keyup"),void(r&&(e.$jelectCurrent.trigger("focus"),e.trigger("afterOpen"))))}),e.$jelectOptions.on("click "+n+".changeOption",s.option,function(){var o=t(this),n=o.data("val");return o.hasClass(a.optionDisabled)?!1:(i.call(e,n),void e.$jelectOptions.removeClass(a.optionsActive))}),e.autocomplete&&e.$jelectCurrent.on("keyup",function(i){var n=t(this),r=o.keyCode,l=i.keyCode,c=String.fromCharCode(l),p=/[a-zA-Zа-яА-ЯЁё0-9]/,u=n.val(),d=e.$jelectOptions.find(s.option),v=e.$jelect.find(s.scroller),f=t.grep(e.values,function(t){return-1===t.value.indexOf(u)});(p.test(c)||l===r.BACKSPACE)&&(e.$jelect.hasClass(a.containerActive)||e.$jelectCurrent.trigger("click"),d.removeClass(a.optionHide),t.each(f,function(t,e){var i=e.value;d.filter('[data-val="'+i+'"]').addClass(a.optionHide)}),d.filter(":visible").removeClass(a.optionActive).first().addClass(a.optionActive),v.scrollTop(0))})},e.prototype.trigger=function(e){var i=this;t.each(i.options.plugins||[],function(o,s){s=t[n].plugins[s],s&&s[e]&&s[e]({$jelect:i.$jelect,$jelectCurrent:i.$jelectCurrent,$jelectOptions:i.$jelectOptions,$jelectInput:i.$jelectInput,options:i.options,text:i.text(),val:i.val()})})},e.prototype.text=function(){return this.$jelectCurrent.text().trim()},e.prototype.val=function(){return this.$jelect.val()},e.prototype.setValue=function(t){return"undefined"!=typeof t&&i.call(this,t),this},e.prototype.serialize=function(){return o.call(this)},e.prototype.disable=function(e){var i=this,o=t[n],s=o.selectors,a=o.options.classes,r=i.$jelectOptions.find(s.option+'[data-val="'+e+'"]'),l=!r.hasClass(a.optionDisabled);if("undefined"!=typeof e){if(l&&(r.addClass(a.optionDisabled),i.$jelectCurrent.data("val")===e)){var c=i.$jelectOptions.find(s.option).not("."+a.optionDisabled).first();i.setValue(c.data("val"))}}else i.$jelect.addClass(a.containerDisabled),i.$jelectInput.attr("disabled",!0);return this},e.prototype.enable=function(e){var i=this,o=t[n],s=o.selectors,a=o.options.classes,r=i.$jelectOptions.find(s.option+'[data-val="'+e+'"]'),l=r.hasClass(a.optionDisabled);return"undefined"!=typeof e&&l?l&&(r=i.$jelectOptions.find(s.option+'[data-val="'+e+'"]'),r.removeClass(a.optionDisabled)):(i.$jelect.removeClass(a.containerDisabled),i.$jelectInput.attr("disabled",!1)),this},t(window.document).on("click "+n+".clickOutside",function(e){var i,o,s=t[n],a=s.selectors,r=t(e.target),l=t(a.options);if(!r.is(a.container)&&!r.closest(a.container).length){if(i=l.closest(a.container).data("jelect"),!i)return;o=i.options.classes,l.hasClass(o.optionsActive)&&(l.removeClass(o.optionsActive).closest(a.container).removeClass(o.containerActive),i.trigger("clickOutside"))}}).on("keydown "+n+".keydown",function(e){var i,o,s,a,r,l,c,p,u,d,v,f,j=t(e.target),C=t[n],g=C.keyCode,h=e.keyCode,$=C.selectors;if(j.is($.current)){if(i=j.closest($.container).data(n),o=i.options.classes,c=j.closest($.container),p=c.find($.scroller),u=c.find($.options),r=u.outerHeight(),d=c.find($.option).not("."+o.optionHide),v=d.filter("."+o.optionActive),l=c.hasClass(o.containerActive),!l)return;switch(s=p.scrollTop(),h){case g.ENTER:v.trigger(n+".changeOption"),e.preventDefault();break;case g.ESC:d.length&&j.trigger(n+".clickCurrent"),j.trigger("blur");break;case g.UP:e.preventDefault();var A=d.first().is(v);v.removeClass(o.optionActive),f=A?d.last():v.prevAll(":visible").first(),a=f.position().top,0>a?s+=a:a>s+r&&(s=a);break;case g.DOWN:e.preventDefault();var y=d.last().is(v);v.removeClass(o.optionActive),f=y?d.first():v.nextAll(":visible").first(),a=f.position().top,a>=r?s+=f.outerHeight():0>a&&(s=a)}f&&(f.addClass(o.optionActive),p.scrollTop(s))}else j.is($.option)&&(i=j.closest($.container).data(n),o=i.options.classes,h===g.ENTER&&j.trigger(n+".changeOption"))}),t.fn[n]=function(i){var o=this,s=arguments;if(void 0===i||"object"==typeof i)return o.each(function(o,s){t.data(s,n)||t.data(s,n,new e(t(s),i))});if("string"==typeof i&&"_"!==i[0]&&"init"!==i){var a;return o.each(function(o,r){var l=t.data(r,n);l instanceof e&&"function"==typeof l[i]&&(a=l[i].apply(l,Array.prototype.slice.call(s,1))),"destroy"===i&&t.data(this,n,null)}),void 0!==a?a:o}}});