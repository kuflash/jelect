/*! jquery.jelect.js v1.0.0 | felixexter | MIT License | https://github.com/CSSSR/jelect/ */
!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof exports?require("jquery"):jQuery)}(function(e){"use strict";var t,i,o,n="jelect";e[n]={version:"1.0.0",options:{classes:{autocomplete:n+"_type_autocomplete",containerActive:n+"_state_active",containerDisabled:n+"_state_disabled",currentActive:n+"-current_state_active",optionsActive:n+"-options_state_active",optionActive:n+"-option_state_active",optionDisabled:n+"-option_state_disabled",optionHide:n+"-option_state_hide"},plugins:[]},plugins:{},selectors:{container:".js-"+n,scroller:".js-"+n+"-scroller",input:".js-"+n+"-input",current:".js-"+n+"-current",options:".js-"+n+"-options",option:".js-"+n+"-option",optionValue:".js-"+n+"-option-value"},keyCode:{BACKSPACE:8,ENTER:13,ESC:27,DOWN:40,UP:38,HOME:36,END:35,PAGE_UP:33,PAGE_DOWN:34}},i=function(t){var i=this,o=e[n],s=o.selectors,a=o.options.classes,l=i.$jelectOptions.find(s.option+'[data-val="'+t+'"]'),r=l.find(s.optionValue).text();return l.hasClass(a.optionDisabled)?(console.error("Option {"+t+"} is disabled"),!1):(l.addClass(a.optionActive).siblings(s.option).removeClass(a.optionActive),i.$jelect.val(t).removeClass(a.containerActive).trigger("jelect.change"),i.autocomplete?i.$jelectCurrent.val(t):(i.$jelectCurrent.text(r).attr("data-val",t),i.$jelectInput.val(t).trigger("change")),void i.trigger("change"))},o=function(){var t=this,i=e[n].selectors,o=[];return t.$jelectOptions.find(i.option).each(function(t,i){var n=e(i);o.push({index:t,value:n.data("val")})}),o},t=function(t,i){var o=e[n],s=o.selectors,a=o.options.classes,l={$jelect:t,$jelectCurrent:t.find(s.current),$jelectOptions:t.find(s.options),$jelectInput:t.find(s.input),autocomplete:t.hasClass(a.autocomplete),options:e.extend(!0,{},o.options,i||{})};e.extend(!0,this,l),this.init()},t.prototype.init=function(){var t=this,o=e[n],s=o.selectors,a=t.options.classes,l=t.val();t.trigger("init"),t.values=t.serialize(),t.$jelect.val(l),t.$jelectCurrent.on("click "+n+".clickCurrent",function(){var i=e(s.container).filter("."+a.containerActive).not(t.$jelect),o=e(s.options).filter("."+a.optionsActive).not(t.$jelectOptions),n=t.$jelect.hasClass(a.containerDisabled),l=!t.$jelect.hasClass(a.containerActive)&&!t.$jelectOptions.hasClass(a.optionsActive);return n?!1:(l&&t.trigger("beforeOpen"),i.length&&o.length&&(i.removeClass(a.containerActive),o.removeClass(a.optionsActive)),t.$jelect.toggleClass(a.containerActive),t.$jelectOptions.toggleClass(a.optionsActive),t.autocomplete&&t.$jelectCurrent.trigger("keyup"),void(l&&(t.$jelectCurrent.trigger("focus"),t.trigger("afterOpen"))))}),t.$jelectOptions.on("click "+n+".changeOption",s.option,function(){var o=e(this),n=o.data("val");return o.hasClass(a.optionDisabled)?!1:(i.call(t,n),void t.$jelectOptions.removeClass(a.optionsActive))}),t.autocomplete&&t.$jelectCurrent.on("keyup",function(i){var n=e(this),l=o.keyCode,r=i.keyCode,c=String.fromCharCode(r),p=/[a-zA-Zа-яА-ЯЁё0-9]/,u=n.val(),v=t.$jelectOptions.find(s.option),d=t.$jelect.find(s.scroller),f=e.grep(t.values,function(e){return-1===e.value.indexOf(u)});(p.test(c)||r===l.BACKSPACE)&&(t.$jelect.hasClass(a.containerActive)||t.$jelectCurrent.trigger("click"),v.removeClass(a.optionHide),e.each(f,function(e,t){var i=t.value;v.filter('[data-val="'+i+'"]').addClass(a.optionHide)}),v.filter(":visible").removeClass(a.optionActive).first().addClass(a.optionActive),d.scrollTop(0))})},t.prototype.trigger=function(t){var i=this;e.each(i.options.plugins||[],function(o,s){s=e[n].plugins[s],s&&s[t]&&s[t]({$jelect:i.$jelect,$jelectCurrent:i.$jelectCurrent,$jelectOptions:i.$jelectOptions,$jelectInput:i.$jelectInput,options:i.options,text:i.text(),val:i.val()})})},t.prototype.text=function(){return this.$jelectCurrent.text().trim()},t.prototype.val=function(){return this.$jelect.val()},t.prototype.setValue=function(e){return"undefined"!=typeof e&&i.call(this,e),this},t.prototype.serialize=function(){return o.call(this)},t.prototype.disable=function(t){var i=this,o=e[n],s=o.selectors,a=o.options.classes,l=i.$jelectOptions.find(s.option+'[data-val="'+t+'"]'),r=!l.hasClass(a.optionDisabled);if("undefined"!=typeof t){if(r&&(l.addClass(a.optionDisabled),i.$jelectCurrent.data("val")===t)){var c=i.$jelectOptions.find(s.option).not("."+a.optionDisabled).first();i.setValue(c.data("val"))}}else i.$jelect.addClass(a.containerDisabled),i.$jelectInput.attr("disabled",!0);return this},t.prototype.enable=function(t){var i=this,o=e[n],s=o.selectors,a=o.options.classes,l=i.$jelectOptions.find(s.option+'[data-val="'+t+'"]'),r=l.hasClass(a.optionDisabled);return"undefined"!=typeof t&&r?r&&(l=i.$jelectOptions.find(s.option+'[data-val="'+t+'"]'),l.removeClass(a.optionDisabled)):(i.$jelect.removeClass(a.containerDisabled),i.$jelectInput.attr("disabled",!1)),this},e(window.document).on("click "+n+".clickOutside",function(t){var i,o,s=e[n],a=s.selectors,l=e(t.target),r=e(a.options);if(!l.is(a.container)&&!l.closest(a.container).length){if(i=r.closest(a.container).data("jelect"),!i)return;o=i.options.classes,r.hasClass(o.optionsActive)&&(r.removeClass(o.optionsActive).closest(a.container).removeClass(o.containerActive),i.trigger("clickOutside"))}}).on("keydown "+n+".keydown",function(t){var i,o,s,a,l,r,c,p,u,v,d,f,C,g,j=e(t.target),h=e[n],$=h.keyCode,A=t.keyCode,b=h.selectors;if(j.is(b.current)){switch(i=j.closest(b.container).data(n),o=i.options.classes,u=j.closest(b.container),v=u.find(b.scroller),d=u.find(b.options),l=d.outerHeight(),f=u.find(b.option).not("."+o.optionHide),C=f.filter("."+o.optionActive),s=v.scrollTop(),A){case $.ENTER:u.hasClass(o.containerActive)?C.trigger(n+".changeOption"):j.trigger("click"),t.preventDefault();break;case $.ESC:f.length&&j.trigger(n+".clickCurrent"),j.trigger("click");break;case $.UP:t.preventDefault();var y=f.first().is(C);C.removeClass(o.optionActive),g=y?f.last():C.prevAll(":visible").not("."+o.optionDisabled).first(),a=g.position().top,0>a?s+=a:a>s+l&&(s=a);break;case $.DOWN:t.preventDefault();var D=f.last().is(C);C.removeClass(o.optionActive),g=D?f.first():C.nextAll(":visible").not("."+o.optionDisabled).first(),a=g.position().top,a>=l?s+=a:0>a&&(s=a);break;case $.HOME:if(t.preventDefault(),C.is(f.first()))return;C.removeClass(o.optionActive),g=f.first(),s=g.position().top;break;case $.END:if(t.preventDefault(),C.is(f.last()))return;C.removeClass(o.optionActive),g=f.last(),s=g.position().top;break;case $.PAGE_UP:t.preventDefault(),r=Math.round(l/C.outerHeight()),c=Math.ceil((C.index()+1)/r)-1,p=c*r-r-1,C.removeClass(o.optionActive),0>p&&(p=0),g=0===p&&f.eq(p).hasClass(o.optionDisabled)?f.eq(p).nextAll(":visible").not("."+o.optionDisabled).first():f.eq(p),s+=g.position().top;break;case $.PAGE_DOWN:t.preventDefault(),r=Math.round(l/C.outerHeight()),c=Math.ceil((C.index()+1)/r)+1,p=c*r-r,C.removeClass(o.optionActive),p>f.length&&(p=f.length-1),g=p===f.length-1?f.eq(p):f.eq(p).nextAll(":visible").not("."+o.optionDisabled).first(),s+=g.position().top}g&&(g.addClass(o.optionActive),v.scrollTop(s))}else j.is(b.option)&&(i=j.closest(b.container).data(n),o=i.options.classes,A===$.ENTER&&j.trigger(n+".changeOption"))}),e.fn[n]=function(i){var o=this,s=arguments;if(void 0===i||"object"==typeof i)return o.each(function(o,s){e.data(s,n)||e.data(s,n,new t(e(s),i))});if("string"==typeof i&&"_"!==i[0]&&"init"!==i){var a;return o.each(function(o,l){var r=e.data(l,n);r instanceof t&&"function"==typeof r[i]&&(a=r[i].apply(r,Array.prototype.slice.call(s,1))),"destroy"===i&&e.data(this,n,null)}),void 0!==a?a:o}}});